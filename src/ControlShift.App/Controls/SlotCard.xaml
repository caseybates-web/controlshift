<UserControl
    x:Class="ControlShift.App.Controls.SlotCard"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Tapped="SlotCard_Tapped">

    <UserControl.Resources>
        <!-- Jiggle storyboard: fires on tap-A (rumble only, not hold-A reorder).
             Quick 200ms left-right shake using a named TranslateTransform. -->
        <Storyboard x:Name="JiggleStoryboard">
            <DoubleAnimationUsingKeyFrames
                Storyboard.TargetName="JiggleTransform"
                Storyboard.TargetProperty="X">
                <DiscreteDoubleKeyFrame KeyTime="0:0:0"      Value="4"  />
                <LinearDoubleKeyFrame   KeyTime="0:0:0.05"   Value="-4" />
                <LinearDoubleKeyFrame   KeyTime="0:0:0.1"    Value="3"  />
                <LinearDoubleKeyFrame   KeyTime="0:0:0.15"   Value="-3" />
                <LinearDoubleKeyFrame   KeyTime="0:0:0.2"    Value="0"  />
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
    </UserControl.Resources>

    <!-- TranslateTransform targeted by JiggleStoryboard. -->
    <UserControl.RenderTransform>
        <TranslateTransform x:Name="JiggleTransform" X="0" Y="0" />
    </UserControl.RenderTransform>

    <!-- Outer grid: no clip, so glow borders with negative margins can bleed
         into the 8px horizontal margin the parent SlotPanel sets on each card. -->
    <Grid>

        <!-- Content card: solid #2D2D2D, border and background never change in code. -->
        <Border x:Name="CardBorder"
                Background="#2D2D2D"
                BorderBrush="#303030"
                BorderThickness="1" CornerRadius="12"
                Padding="16,14" MinHeight="80">

            <!-- Two-row grid: main content row + hold-to-reorder progress bar -->
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Row 0: player badge + device info + battery -->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Player index badge (P1–P4) -->
                    <Border x:Name="PlayerBadgeBorder" Grid.Column="0"
                            Background="#555555"
                            CornerRadius="8" Padding="10,5"
                            VerticalAlignment="Center" Margin="0,0,14,0">
                        <TextBlock x:Name="SlotBadge" Text="P1"
                                   FontFamily="Segoe UI" FontSize="14" FontWeight="Bold"
                                   Foreground="{StaticResource XbTextBrush}" />
                    </Border>

                    <!-- Connected device info — visible only when slot is occupied -->
                    <StackPanel x:Name="ConnectedContent" Grid.Column="1"
                                VerticalAlignment="Center" Spacing="3"
                                Visibility="Collapsed">

                        <!-- Controller name -->
                        <TextBlock x:Name="DeviceName" Text=""
                                   FontFamily="Segoe UI" FontSize="15" FontWeight="Bold"
                                   Foreground="{StaticResource XbTextBrush}"
                                   TextTrimming="CharacterEllipsis" />

                        <!-- Connection type: plain small text below name -->
                        <TextBlock x:Name="ConnectionText" Text=""
                                   FontFamily="Segoe UI" FontSize="11"
                                   Foreground="#ABABAB" />

                        <!-- Badges + VID:PID row -->
                        <StackPanel Orientation="Horizontal" Spacing="6" Margin="0,2,0,0">

                            <Border x:Name="IntegratedBadge"
                                    Background="#1D4B1D" CornerRadius="8"
                                    Padding="8,2" Visibility="Collapsed">
                                <TextBlock Text="INTEGRATED"
                                           FontFamily="Segoe UI" FontSize="10" FontWeight="SemiBold"
                                           Foreground="{StaticResource XbAccentBrush}" />
                            </Border>

                            <Border x:Name="BrandBadge"
                                    Background="#3A3A3A" CornerRadius="8"
                                    Padding="8,2" Visibility="Collapsed">
                                <TextBlock x:Name="BrandText" Text=""
                                           FontFamily="Segoe UI" FontSize="10" FontWeight="SemiBold"
                                           Foreground="#ABABAB" />
                            </Border>

                            <TextBlock x:Name="VidPidText" Text=""
                                       FontFamily="Cascadia Mono,Consolas,Courier New" FontSize="10"
                                       Foreground="#666666" VerticalAlignment="Center"
                                       Visibility="Collapsed" />

                        </StackPanel>
                    </StackPanel>

                    <!-- Empty slot placeholder — dash centered in the info column -->
                    <TextBlock x:Name="EmptyDash" Grid.Column="1"
                               Text="—" VerticalAlignment="Center"
                               FontFamily="Segoe UI" FontSize="20"
                               Foreground="#444444" />

                    <!-- Battery indicator -->
                    <StackPanel x:Name="BatterySection" Grid.Column="2"
                                Orientation="Horizontal" VerticalAlignment="Center"
                                Spacing="4" Visibility="Collapsed">
                        <TextBlock x:Name="BatteryIcon" Text=""
                                   FontFamily="Segoe MDL2 Assets" FontSize="14"
                                   Foreground="#ABABAB" />
                        <TextBlock x:Name="BatteryText" Text=""
                                   FontFamily="Segoe UI" FontSize="11"
                                   Foreground="#ABABAB" />
                    </StackPanel>
                </Grid>

                <!-- Row 1: hold-to-reorder progress bar.
                     Fills green over 500ms while A is held. -->
                <ProgressBar x:Name="HoldProgressBar" Grid.Row="1"
                             Minimum="0" Maximum="1" Value="0"
                             Height="3" Margin="0,10,0,0"
                             Foreground="#107C10"
                             Background="Transparent"
                             IsIndeterminate="False"
                             Visibility="Collapsed" />
            </Grid>
        </Border>

        <!-- Layered white glow rings — all Collapsed in Normal / Dimmed state.
             Negative margins extend each ring beyond the Grid into the card's margin
             so the glow follows the rounded corners without any Composition API.
             IsHitTestVisible=False lets taps fall through to CardBorder. -->

        <!-- Outer ring: faintest, extends 4px outside the card edge. -->
        <Border x:Name="GlowOuter"
                Background="Transparent" CornerRadius="14"
                BorderBrush="White" BorderThickness="1" Opacity="0.2"
                Margin="-4" IsHitTestVisible="False" Visibility="Collapsed" />

        <!-- Middle ring: medium brightness, extends 2px outside the card edge. -->
        <Border x:Name="GlowMiddle"
                Background="Transparent" CornerRadius="13"
                BorderBrush="White" BorderThickness="1" Opacity="0.4"
                Margin="-2" IsHitTestVisible="False" Visibility="Collapsed" />

        <!-- Inner ring: brightest, flush with the card edge.
             BorderThickness set to 2 (Focused) or 3 (Selected) in code. -->
        <Border x:Name="GlowInner"
                Background="Transparent" CornerRadius="12"
                BorderBrush="White" BorderThickness="2" Opacity="0.9"
                Margin="0" IsHitTestVisible="False" Visibility="Collapsed" />

    </Grid>
</UserControl>
