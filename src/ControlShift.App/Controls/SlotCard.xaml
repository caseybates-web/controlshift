<UserControl
    x:Class="ControlShift.App.Controls.SlotCard"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Tapped="SlotCard_Tapped">

    <!-- Outer grid holds both the content card and the focus-ring overlay.
         Grid has no clip so the DropShadow on GlowBorder can bleed into the margin. -->
    <Grid>

        <!-- Content card — always below GlowBorder in z-order -->
        <Border x:Name="CardBorder"
                Background="#D9222222"
                BorderBrush="#303030"
                BorderThickness="1" CornerRadius="12"
                Padding="16,14" MinHeight="80">

            <!-- Two-row grid: main content + hold-to-reorder progress bar -->
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Row 0: player badge + device info + battery -->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Player index badge (P1–P4) -->
                    <Border x:Name="PlayerBadgeBorder" Grid.Column="0"
                            Background="#555555"
                            CornerRadius="8" Padding="10,5"
                            VerticalAlignment="Center" Margin="0,0,14,0">
                        <TextBlock x:Name="SlotBadge" Text="P1"
                                   FontFamily="Segoe UI" FontSize="14" FontWeight="Bold"
                                   Foreground="{StaticResource XbTextBrush}" />
                    </Border>

                    <!-- Connected device info — visible only when slot is occupied -->
                    <StackPanel x:Name="ConnectedContent" Grid.Column="1"
                                VerticalAlignment="Center" Spacing="3"
                                Visibility="Collapsed">

                        <!-- Controller name -->
                        <TextBlock x:Name="DeviceName" Text=""
                                   FontFamily="Segoe UI" FontSize="15" FontWeight="Bold"
                                   Foreground="{StaticResource XbTextBrush}"
                                   TextTrimming="CharacterEllipsis" />

                        <!-- Connection type: plain small text below name -->
                        <TextBlock x:Name="ConnectionText" Text=""
                                   FontFamily="Segoe UI" FontSize="11"
                                   Foreground="#ABABAB" />

                        <!-- Badges + VID:PID row -->
                        <StackPanel Orientation="Horizontal" Spacing="6" Margin="0,2,0,0">

                            <Border x:Name="IntegratedBadge"
                                    Background="#1D4B1D" CornerRadius="8"
                                    Padding="8,2" Visibility="Collapsed">
                                <TextBlock Text="INTEGRATED"
                                           FontFamily="Segoe UI" FontSize="10" FontWeight="SemiBold"
                                           Foreground="{StaticResource XbAccentBrush}" />
                            </Border>

                            <Border x:Name="BrandBadge"
                                    Background="#3A3A3A" CornerRadius="8"
                                    Padding="8,2" Visibility="Collapsed">
                                <TextBlock x:Name="BrandText" Text=""
                                           FontFamily="Segoe UI" FontSize="10" FontWeight="SemiBold"
                                           Foreground="#ABABAB" />
                            </Border>

                            <TextBlock x:Name="VidPidText" Text=""
                                       FontFamily="Cascadia Mono,Consolas,Courier New" FontSize="10"
                                       Foreground="#666666" VerticalAlignment="Center"
                                       Visibility="Collapsed" />

                        </StackPanel>
                    </StackPanel>

                    <!-- Empty slot placeholder — dash centered in the info column -->
                    <TextBlock x:Name="EmptyDash" Grid.Column="1"
                               Text="—" VerticalAlignment="Center"
                               FontFamily="Segoe UI" FontSize="20"
                               Foreground="#444444" />

                    <!-- Battery indicator -->
                    <StackPanel x:Name="BatterySection" Grid.Column="2"
                                Orientation="Horizontal" VerticalAlignment="Center"
                                Spacing="4" Visibility="Collapsed">
                        <TextBlock x:Name="BatteryIcon" Text=""
                                   FontFamily="Segoe MDL2 Assets" FontSize="14"
                                   Foreground="#ABABAB" />
                        <TextBlock x:Name="BatteryText" Text=""
                                   FontFamily="Segoe UI" FontSize="11"
                                   Foreground="#ABABAB" />
                    </StackPanel>
                </Grid>

                <!-- Row 1: hold-to-reorder progress bar.
                     Fills green over 500ms while A is held.
                     Collapsed until a hold begins; hidden immediately on tap or reorder entry. -->
                <ProgressBar x:Name="HoldProgressBar" Grid.Row="1"
                             Minimum="0" Maximum="1" Value="0"
                             Height="3" Margin="0,10,0,0"
                             Foreground="#107C10"
                             Background="Transparent"
                             IsIndeterminate="False"
                             Visibility="Collapsed" />
            </Grid>
        </Border>

        <!-- Focus ring overlay: same CornerRadius as CardBorder, transparent fill so
             card content shows through, white stroke controlled in code.
             Sits in front of CardBorder (later in z-order).  IsHitTestVisible=False
             so taps pass through to CardBorder → SlotCard_Tapped.
             A SpriteVisual+DropShadow attached via SetElementChildVisual provides the
             soft glow that radiates outward into the 8px margin. -->
        <Border x:Name="GlowBorder"
                Background="Transparent"
                CornerRadius="12"
                BorderBrush="Transparent"
                BorderThickness="2"
                IsHitTestVisible="False"
                Visibility="Collapsed" />

    </Grid>
</UserControl>
