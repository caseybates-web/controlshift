<Window
    x:Class="ControlShift.App.PopupWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:ControlShift.App.ViewModels">

    <!--
        Root grid: RequestedTheme="Dark" forces WinUI controls (TextBlock, Border, etc.)
        to render with white text / dark foregrounds regardless of the system theme.
        The explicit Background overrides the theme default.
    -->
    <Grid RequestedTheme="Dark" Background="#FF0F172A">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />   <!-- Header -->
            <RowDefinition Height="*"    />   <!-- Scroll content -->
            <RowDefinition Height="Auto" />   <!-- Footer / Exit -->
        </Grid.RowDefinitions>

        <!-- ── Header ─────────────────────────────────────────────────────── -->
        <Grid Grid.Row="0" Padding="16,14,12,14">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <TextBlock
                Grid.Column="0"
                Text="ControlShift"
                Foreground="White"
                FontSize="15"
                FontWeight="SemiBold"
                VerticalAlignment="Center" />

            <!-- Close button hides the window rather than destroying it. -->
            <Button
                Grid.Column="1"
                Content="✕"
                Click="CloseButton_Click"
                Background="Transparent"
                Foreground="#FF94A3B8"
                BorderThickness="0"
                Padding="6"
                FontSize="13"
                VerticalAlignment="Center"
                ToolTipService.ToolTip="Hide" />
        </Grid>

        <!-- Separator -->
        <Rectangle Grid.Row="0" Height="1" Fill="#FF1E293B" VerticalAlignment="Bottom" />

        <!-- ── Scroll content ─────────────────────────────────────────────── -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <StackPanel Padding="12,10,12,4" Spacing="0">

                <!-- PLAYER SLOTS section label -->
                <TextBlock
                    Text="PLAYER SLOTS"
                    Foreground="#FF64748B"
                    FontSize="11"
                    FontWeight="SemiBold"
                    Margin="4,0,0,8" />

                <!-- Slot cards P1–P4 -->
                <ItemsRepeater ItemsSource="{x:Bind Slots}">
                    <ItemsRepeater.Layout>
                        <StackLayout Spacing="8" />
                    </ItemsRepeater.Layout>
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate x:DataType="vm:SlotViewModel">
                            <Border
                                Background="#FF1E293B"
                                CornerRadius="8"
                                Padding="12,10">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />  <!-- Player badge -->
                                        <ColumnDefinition Width="*"    />  <!-- Device info -->
                                        <ColumnDefinition Width="Auto" />  <!-- Battery -->
                                    </Grid.ColumnDefinitions>

                                    <!-- Player badge -->
                                    <Border
                                        Grid.Column="0"
                                        Background="#FF00E5FF"
                                        CornerRadius="4"
                                        Padding="8,3"
                                        VerticalAlignment="Center">
                                        <TextBlock
                                            Text="{x:Bind PlayerLabel}"
                                            Foreground="#FF0F172A"
                                            FontWeight="Bold"
                                            FontSize="12" />
                                    </Border>

                                    <!-- Device name + connection type -->
                                    <StackPanel
                                        Grid.Column="1"
                                        Margin="12,0,8,0"
                                        VerticalAlignment="Center"
                                        Spacing="2">
                                        <TextBlock
                                            Text="{x:Bind DeviceName, Mode=OneWay}"
                                            Foreground="White"
                                            FontSize="13"
                                            TextTrimming="CharacterEllipsis" />
                                        <TextBlock
                                            Text="{x:Bind ConnectionLabel, Mode=OneWay}"
                                            Foreground="#FF64748B"
                                            FontSize="11"
                                            Visibility="{x:Bind ConnectionVisibility, Mode=OneWay}" />
                                    </StackPanel>

                                    <!-- Battery percentage (wireless only) -->
                                    <TextBlock
                                        Grid.Column="2"
                                        Text="{x:Bind BatteryText, Mode=OneWay}"
                                        Foreground="#FF64748B"
                                        FontSize="12"
                                        VerticalAlignment="Center"
                                        Visibility="{x:Bind BatteryVisibility, Mode=OneWay}" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>

                <!-- UNASSIGNED section label -->
                <TextBlock
                    Text="UNASSIGNED"
                    Foreground="#FF64748B"
                    FontSize="11"
                    FontWeight="SemiBold"
                    Margin="4,16,0,8" />

                <!-- Unassigned device list (populated in Step 6) -->
                <ItemsRepeater ItemsSource="{x:Bind UnassignedDevices}">
                    <ItemsRepeater.Layout>
                        <StackLayout Spacing="8" />
                    </ItemsRepeater.Layout>
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate x:DataType="x:String">
                            <Border Background="#FF1E293B" CornerRadius="8" Padding="12,10">
                                <TextBlock
                                    Text="{x:Bind}"
                                    Foreground="White"
                                    FontSize="13" />
                            </Border>
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>

                <!-- Empty-state placeholder shown when UnassignedDevices is empty -->
                <Border
                    Background="#FF1E293B"
                    CornerRadius="8"
                    Padding="12,10"
                    Visibility="{x:Bind UnassignedEmptyVisibility, Mode=OneWay}">
                    <TextBlock
                        Text="No unassigned controllers"
                        Foreground="#FF475569"
                        FontSize="13"
                        HorizontalAlignment="Center" />
                </Border>

                <Rectangle Height="8" />
            </StackPanel>
        </ScrollViewer>

        <!-- ── Footer ─────────────────────────────────────────────────────── -->
        <Border
            Grid.Row="2"
            BorderBrush="#FF1E293B"
            BorderThickness="0,1,0,0"
            Padding="12,8">
            <Button
                Content="Exit ControlShift"
                Click="ExitButton_Click"
                Background="Transparent"
                Foreground="#FF64748B"
                BorderThickness="0"
                Padding="4,4"
                FontSize="12"
                HorizontalAlignment="Right" />
        </Border>
    </Grid>
</Window>
